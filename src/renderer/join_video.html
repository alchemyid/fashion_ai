<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Video - Fashion AI Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Tambahan Style untuk Watermark Controls */
        .watermark-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
        }
        .control-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .control-item label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-text);
        }
        .control-item select, .control-item input[type="range"], .control-item input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
        }
        .value-display {
            float: right;
            font-size: 0.8rem;
            color: var(--color-primary);
            font-weight: bold;
        }
        /* Preview Watermark Kecil */
        .watermark-preview-container {
            margin-top: 0.5rem;
            text-align: center;
            display: none;
            background: #eee; /* Checkerboard pattern simulation for transparency */
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        .watermark-preview-img {
            max-height: 80px;
            max-width: 100%;
            object-fit: contain;
        }
        .btn-isolate {
            background-color: #805ad5;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }
        .btn-isolate:hover { background-color: #6b46c1; }
        .btn-isolate:disabled { background-color: #cbd5e0; cursor: not-allowed; }
    </style>
</head>
<body>
<div class="dashboard-layout">
    <!-- Navbar will be loaded here dynamically -->

    <main class="content">
        <div class="content-header">
            <h1><i class="fas fa-photo-video"></i> Join Video</h1>
            <p>Gabungkan beberapa klip video, tambahkan voiceover, musik latar, dan watermark.</p>
        </div>

        <div class="feature-layout">
            <!-- Kolom Kontrol (Kiri) -->
            <div class="controls-column">
                <form id="joinVideoForm" class="form-card" style="margin: 0; margin-bottom: 2rem;">

                    <!-- 1. Upload Video Sequence -->
                    <div class="form-group">
                        <label class="font-bold text-xl mb-2 block">1. Video Sequence</label>
                        <p class="helper-text">Upload klip video (.mp4). Urutan upload menentukan urutan video akhir.</p>

                        <label for="videoInput" class="upload-box-wide">
                            <i class="fas fa-plus-circle"></i>
                            <p>Tambah Video</p>
                            <span>(Klik untuk memilih file MP4)</span>
                            <input type="file" id="videoInput" accept=".mp4" multiple>
                        </label>

                        <!-- Daftar Video yang diupload -->
                        <div id="videoListContainer" class="video-list-container">
                            <p class="empty-state">Belum ada video yang dipilih.</p>
                        </div>
                    </div>

                    <!-- 2. Upload Voice Audio -->
                    <div class="form-group">
                        <label class="font-bold text-xl mb-2 block">2. Audio (Optional)</label>
                        <div style="display: flex; gap: 1rem;">
                            <label for="voiceInput" class="upload-box-compact" style="flex:1;">
                                <div class="icon-side"><i class="fas fa-microphone-alt"></i></div>
                                <div class="text-side">
                                    <p>Voice</p>
                                    <span id="voiceFileName">(MP3/WAV)</span>
                                </div>
                                <input type="file" id="voiceInput" accept="audio/*">
                            </label>
                            <label for="backsoundInput" class="upload-box-compact" style="flex:1;">
                                <div class="icon-side"><i class="fas fa-music"></i></div>
                                <div class="text-side">
                                    <p>BGM</p>
                                    <span id="backsoundFileName">(MP3/WAV)</span>
                                </div>
                                <input type="file" id="backsoundInput" accept="audio/*">
                            </label>
                        </div>
                    </div>

                    <!-- 3. Watermark (New Feature) -->
                    <div class="form-group">
                        <label class="font-bold text-xl mb-2 block">3. Watermark (Optional)</label>
                        <p class="helper-text">Logo atau branding overlay.</p>

                        <label for="watermarkInput" class="upload-box-compact">
                            <div class="icon-side"><i class="fas fa-copyright"></i></div>
                            <div class="text-side">
                                <p>Upload Image Watermark</p>
                                <span id="watermarkFileName">(PNG/JPG)</span>
                            </div>
                            <input type="file" id="watermarkInput" accept="image/png, image/jpeg">
                        </label>

                        <!-- Preview Watermark & Tombol Isolasi -->
                        <div id="watermarkPreviewContainer" class="watermark-preview-container">
                            <img id="watermarkPreview" class="watermark-preview-img" src="" alt="Watermark Preview">
                            <div style="margin-top: 8px;">
                                <div style="display:flex; gap: 5px; margin-bottom: 5px;">
                                    <input type="text" id="watermarkPrompt" placeholder="Deskripsi (misal: logo, teks)" value="logo" style="flex:1; padding: 0.3rem; font-size: 0.8rem; border:1px solid #ccc; border-radius: 4px;">
                                </div>
                                <button type="button" id="isolateWatermarkBtn" class="btn-isolate">
                                    <i class="fas fa-magic"></i> Remove Background (AI)
                                </button>
                                <p id="isolateStatus" style="font-size: 0.75rem; color: #666; margin-top: 4px; display: none;"></p>
                            </div>
                        </div>

                        <div class="watermark-controls" id="watermarkSettings" style="display: none;">
                            <div class="control-item" style="grid-column: span 2;">
                                <label>Posisi</label>
                                <select id="watermarkPosition">
                                    <option value="top_right">Pojok Kanan Atas</option>
                                    <option value="top_left">Pojok Kiri Atas</option>
                                    <option value="bottom_right" selected>Pojok Kanan Bawah</option>
                                    <option value="bottom_left">Pojok Kiri Bawah</option>
                                    <option value="center">Tengah (Center)</option>
                                </select>
                            </div>
                            <div class="control-item">
                                <label>Opacity <span id="opacityValue" class="value-display">70%</span></label>
                                <input type="range" id="watermarkOpacity" min="10" max="100" value="70">
                            </div>
                            <!-- NEW: SLIDER UKURAN -->
                            <div class="control-item">
                                <label>Ukuran (Width) <span id="sizeValue" class="value-display">200px</span></label>
                                <input type="range" id="watermarkSize" min="50" max="600" value="200">
                            </div>
                        </div>
                    </div>

                    <!-- Action Button -->
                    <button type="submit" class="btn-execute" id="processButton" disabled>
                        <i class="fas fa-cogs"></i>
                        Process & Join Video
                    </button>
                </form>
            </div>

            <!-- Kolom Hasil (Kanan) -->
            <div class="result-column" style="margin-top: 2rem;">
                <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                    <h3 class="font-bold text-xl mb-4">Preview & Result</h3>

                    <!-- Loading Indicator -->
                    <div id="loading" style="display:none;">
                        <div class="progress-container">
                            <p><i class="fas fa-spinner fa-spin"></i> Memproses Video...</p>
                            <div class="progress-bar-bg">
                                <div id="progressBar" class="progress-bar-fill" style="width: 0%"></div>
                            </div>
                            <span id="progressText">0%</span>
                        </div>
                    </div>

                    <div id="errorMessage" class="error-message"></div>

                    <!-- Hasil Video Player -->
                    <div id="videoResultDisplay" style="min-height: 350px; margin-bottom: 1.5rem;">
                        <div class="placeholder-state">
                            <i class="fas fa-film"></i>
                            <p>Video hasil penggabungan akan muncul di sini</p>
                        </div>
                    </div>

                    <a href="#" id="downloadBtn" class="btn-execute" style="display: none; width: 100%; text-align: center; justify-content: center;">
                        <i class="fas fa-download"></i> Download Video
                    </a>
                </div>
        </div>
    </main>
</div>

<script src="js/navbar.js"></script>
<script src="js/join_video.js"></script>
<script>
    loadNavbar('join_video');
</script>
</body>
</html>